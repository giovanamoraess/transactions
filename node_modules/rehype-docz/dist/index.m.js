import{relative,dirname}from"path";import is from"unist-util-is";import flatten from"lodash.flatten";import nodeToString from"hast-util-to-string";import{jsx,imports}from"docz-utils";import{format}from"docz-utils/lib/format";import{getSandboxImportInfo}from"docz-utils/lib/codesandbox";const isPlayground=o=>"Playground"===o,addPropsOnPlayground=async(o,t,r,i,a)=>{const e=jsx.componentName(o.value),n=RegExp(`^\\<${e}`);if(isPlayground(e)){const s=(await format(nodeToString(o))).slice(1,1/0),m=`{props,${r.join(",")}}`,d=jsx.sanitizeCode(jsx.removeTags(s)),l=await getSandboxImportInfo(d,i,a);o.value=o.value.replace(n,`<${e} __position={${t}} __codesandbox={\`${l}\`} __code={\`${d}\`} __scope={${m}}`)}},addComponentsProps=(o,t,r)=>async(i,a)=>{await addPropsOnPlayground(i,a,o,t,r)};var index=o=>()=>(t,r)=>{const i=t.children.filter(o=>is("import",o)),a=flatten(i.map(imports.getFullImports)),e=flatten(i.map(imports.getImportsVariables)),n=relative(o,dirname(r.history[0])),s=t.children.filter(o=>is("jsx",o)).map(addComponentsProps(e,a,n));return Promise.all(s).then(()=>t)};export default index;
